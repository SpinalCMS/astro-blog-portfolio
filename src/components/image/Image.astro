---
// functions
import { getDimensions, getMetadata, buildPublicPath } from '@/functions/Media'

// data
import { imageConfig } from "@/src/config.ts"

// props
export interface Props {
    file: string;
    classes?: string;
    alt?: string;
    watermark?: boolean;
}
const { file, classes, alt, watermark = false } = Astro.props;

const dimensions = getDimensions(file); // get the image dimensions

let caption = '';
if (typeof alt === 'undefined') {
    caption =  await getMetadata(file, "caption"); // grab the caption from the image to use as an alt tag
}
---

<img
    data-blink-ops={ watermark ? `overlay-uuid: ${imageConfig.logo}; overlay-dimensions: 15%25x15%25; overlay-coordinates: 50%25,90%25` : `` }
    data-blink-src={ buildPublicPath(file) }
    class={ classes }
    alt={ alt ? alt : caption }
    width={ dimensions.width }
    height={ dimensions.height }
>

<style lang="scss">
    img {
        box-shadow: var(--site-shadow);
    }
</style>